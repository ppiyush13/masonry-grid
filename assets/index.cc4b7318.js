import{r as i,j as y,a as R,R as w,b as v,c as N,d as E,B as M}from"./vendor.d87d5cc6.js";const I=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function n(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerpolicy&&(o.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?o.credentials="include":r.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(r){if(r.ep)return;r.ep=!0;const o=n(r);fetch(r.href,o)}};I();const x=new URL("https://api.giphy.com/v1/gifs/trending");x.searchParams.set("api_key","OoWza0uVc3TYKVYzWNJ9cbZLR60T6oN8");const L=(e=50)=>{let t=0;return async()=>{x.searchParams.set("limit",e.toString()),x.searchParams.set("offset",(t*e+1).toString()),t+=1;const n=await fetch(x.toString()),{data:s}=await n.json();return s}},$=e=>{const t=i.exports.useRef(null),[n,s]=i.exports.useState([]);return i.exports.useEffect(()=>{if(t.current==null)return;const r=new IntersectionObserver(async o=>{if(o[0].isIntersecting){const a=await e();s(f=>f.concat(a))}},{rootMargin:"20%"});return r.observe(t.current),()=>{t.current&&r.unobserve(t.current)}},[t.current]),{data:n,loaderRef:t}};const c=y.exports.jsx,h=y.exports.jsxs,b=y.exports.Fragment,C=()=>{const e=["rgb(255, 243, 92)","rgb(255, 102, 102)","rgb(153, 51, 255)","rgb(0, 255, 153)","rgb(0, 204, 255)"],t=Math.floor(Math.random()*100)%e.length;return e[t]},k=e=>(16+ +e.height)/e.width,j=e=>{const t=document.createElement("div"),n=e.downsized_small,r=`
    <video
      src="${n.mp4}"
      autoplay
      muted
      loop
      width="100%"
      title={title}
      preload="none"
      crossorigin="anonymous"
      style="aspect-ratio: ${n.width} / ${n.height}; background-color: ${C()}"
    ></video>
  `;return t.innerHTML=r,t},z=({data:e})=>{const t=i.exports.useRef(),n=i.exports.useRef(),s=i.exports.useRef(),r=i.exports.useRef(),o=i.exports.useRef(0),a=i.exports.useRef([0,0,0,0]);return i.exports.useEffect(()=>{if(!e||e.length===0)return;const f=()=>{const u=a.current;let d=0,p=u[0];for(let g=1;g<u.length;g++)u[g]<p&&(p=u[g],d=g);return d},l=[t,n,s,r];console.time("start"),new Array(4).fill("");let m=new Array(4).fill(null).map(()=>document.createDocumentFragment());for(let u=o.current;u<e.length;u++){const d=e[u].images,p=f();m[p].appendChild(j(d).firstElementChild),a.current[p]+=k(d.downsized_small)}l.forEach((u,d)=>{u.current.appendChild(m[d])}),console.timeEnd("start"),o.current=e.length},[e]),h(b,{children:[h("div",{className:"grid-pane",children:[c("div",{className:"lane",ref:t}),c("div",{className:"lane",ref:n}),c("div",{className:"lane",ref:s}),c("div",{className:"lane",ref:r})]}),c("div",{style:{height:"1px"}})]})},_=({data:e})=>{const t=i.exports.useRef(0),n=i.exports.useRef([0,0,0,0]),[s,r]=i.exports.useState(()=>new Array(4).fill(null).map(()=>[]));return i.exports.useEffect(()=>{const o=l=>(16+ +l.height)/+l.width,a=()=>{const l=n.current;let m=0,u=l[0];for(let d=1;d<l.length;d++)l[d]<u&&(u=l[d],m=d);return m};console.time("start");const f=[...s];for(let l=t.current;l<e.length;l++){const m=e[l].images,u=a();f[u].push(c(A,{dataItem:m},l)),n.current[u]+=o(m.downsized_small)}r(f),t.current=e.length,console.timeEnd("start")},[e]),h("div",{className:"grid-pane",children:[c("div",{className:"lane",children:s[0]}),c("div",{className:"lane",children:s[1]}),c("div",{className:"lane",children:s[2]}),c("div",{className:"lane",children:s[3]})]})},A=({dataItem:e})=>c("video",{src:e.downsized_small.mp4,autoPlay:!0,muted:!0,loop:!0,width:"100%",preload:"none",crossOrigin:"anonymous",style:{aspectRatio:`${e.downsized_small.width} / ${e.downsized_small.height}`,backgroundColor:B()}}),B=()=>{const e=["rgb(255, 243, 92)","rgb(255, 102, 102)","rgb(153, 51, 255)","rgb(0, 255, 153)","rgb(0, 204, 255)"],t=Math.floor(Math.random()*100)%e.length;return e[t]},O=()=>{const e=["rgb(255, 243, 92)","rgb(255, 102, 102)","rgb(153, 51, 255)","rgb(0, 255, 153)","rgb(0, 204, 255)"],t=Math.floor(Math.random()*100)%e.length;return e[t]},S=e=>(16+ +e.height)/e.width,T=({data:e})=>{const t=i.exports.useRef(),n=i.exports.useRef(),s=i.exports.useRef(),r=i.exports.useRef(),o=i.exports.useRef(0),a=i.exports.useRef([0,0,0,0]);return i.exports.useEffect(()=>{if(!e||e.length===0||!t.current||!n.current||!s.current||!r.current)return;const f=()=>{const l=a.current;let m=0,u=l[0];for(let d=1;d<l.length;d++)l[d]<u&&(u=l[d],m=d);return m};t.current,n.current,s.current,r.current,console.time("start"),H(o.current,[t.current,n.current,s.current,r.current],e,f,a.current),console.timeEnd("start"),o.current=e.length},[e]),h(b,{children:[h("div",{className:"grid-pane",children:[c("div",{className:"lane",ref:t}),c("div",{className:"lane",ref:n}),c("div",{className:"lane",ref:s}),c("div",{className:"lane",ref:r})]}),c("div",{style:{height:"1px"}})]})},H=(e,t,n,s,r)=>{G(e,n.length,50,o=>{const a=n[o].images,f=s();t[f].appendChild(P(a).firstElementChild),r[f]+=S(a.downsized_small)})},P=e=>{const t=document.createElement("div"),n=e.downsized_small,r=`
    <video
      src="${n.mp4}"
      autoplay
      muted
      loop
      width="100%"
      title={title}
      preload="none"
      crossorigin="anonymous"
      style="aspect-ratio: ${n.width} / ${n.height}; background-color: ${O()}"
    ></video>
  `;return t.innerHTML=r,t},G=async(e,t,n,s)=>{const r=t-e,o=Math.ceil(r/n),a=Math.floor(r/o);for(let f=0;f<o;f++){console.time("start");for(let l=0,m=f*a;l<a&&m<r;l++,m++)requestIdleCallback(()=>{s(m)});console.timeEnd("start")}},D=L();function F(){const{data:e,loaderRef:t}=$(D);return i.exports.useEffect(()=>{console.log("react version:",i.exports.version),console.log("react-dom version:",R.exports.version)},[]),h("main",{className:"App",children:[h(w,{children:[c(v,{path:"/react",element:c(_,{data:e})}),c(v,{path:"/javascript",element:c(z,{data:e})}),c(v,{path:"/javascript-idle",element:c(T,{data:e})})]}),c("div",{ref:t,style:{height:"1px"}})]})}const V=N.createRoot(document.getElementById("root"));V.render(c(E.StrictMode,{children:c(M,{basename:"/masonry-grid/",children:c(F,{})})}));
